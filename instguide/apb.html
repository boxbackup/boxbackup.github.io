<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Appendix B. Compiling bbackupd on Windows using Visual C++</title><link rel="stylesheet" type="text/css" href="../bbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Box Backup Build and Installation Guide"><link rel="up" href="index.html" title="Box Backup Build and Installation Guide"><link rel="prev" href="apa.html" title="Appendix A. Box Backup and SSL"><link rel="next" href="apc.html" title="Appendix C. Compilation and installation by building an RPM on Linux"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="header"><div id="logo"><img src="../images/bblogo.png" alt="logo" height="65" width="331" border="0" vspace="5" align="middle"><img src="../images/stepahead.png" alt="a step ahead in data security" width="182" height="11" hspace="10" vspace="20" border="0" align="middle"></div></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Appendix B. Compiling bbackupd on Windows using Visual C++</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="apa.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="apc.html">Next</a></td></tr></table><hr></div><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="idp61950672"></a>Appendix B. Compiling bbackupd on Windows using Visual C++</h1></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="apb.html#idp61954000">Tools</a></span></dt><dd><dl><dt><span class="section"><a href="apb.html#idp61955024">Visual C++</a></span></dt><dt><span class="section"><a href="apb.html#idp61958608">Perl</a></span></dt><dt><span class="section"><a href="apb.html#idp61960784">Libraries</a></span></dt><dt><span class="section"><a href="apb.html#idp61975760">Download Box Backup</a></span></dt><dt><span class="section"><a href="apb.html#idp61981264">Configure Box Backup</a></span></dt><dt><span class="section"><a href="apb.html#idp61984592">Compile Box Backup</a></span></dt><dt><span class="section"><a href="apb.html#idp61987664">Install Box Backup</a></span></dt><dt><span class="section"><a href="apb.html#idp61995600">Windows Service</a></span></dt></dl></dd></dl></div><p>This Appendix explains how to build the bbackupd daemon for Windows
    using the Visual C++ compiler.</p><p>If you have any problems following these instructions, please sign
    up to the <a class="ulink" href="http://lists.warhead.org.uk/mailman/listinfo/boxbackup" target="_top">mailing
    lis</a>t and report them to us, or send an email to <a class="ulink" href="mailto:bbwiki@qwirx.com" target="_top">Chris Wilson</a>. Thanks!</p><p><span class="bold"><strong>Note</strong></span>: bbstored will not be built
    with this process. bbstored is not currently supported on Windows. There
    are no plans for bbstored support on Windows.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp61954000"></a>Tools</h2></div></div></div><p>You will need quite a bit of software to make this work. All of it
      is available for free on the Internet, although Visual C++ Express has
      license restrictions and a time limit.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp61955024"></a>Visual C++</h3></div></div></div><p>Microsoft's Visual C++ compiler and development environment are
        part of their commercial product <a class="ulink" href="http://msdn.microsoft.com/vstudio/" target="_top">Visual Studio</a>. Visual
        Studio 2005 is supported, and 2003 should work as well.</p><p>You can also <a class="ulink" href="http://msdn.microsoft.com/vstudio/express/visualc/download/" target="_top">download</a>
        a free copy of Visual C++ 2005 Express. This copy must be registered
        (activated) within 30 days, and is free for one year.</p><p>You will need the <a class="ulink" href="http://msdn.microsoft.com/vstudio/express/visualc/usingpsdk/" target="_top">Platform
        SDK</a> to allow you to compile Windows applications.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp61958608"></a>Perl</h3></div></div></div><p>Download and install <a class="ulink" href="http://www.activestate.com/Products/ActivePerl/" target="_top">ActivePerl for
        Windows</a>, which you can probably find <a class="ulink" href="http://downloads.activestate.com/ActivePerl/Windows/5.6/ActivePerl-5.6.1.638-MSWin32-x86.msi" target="_top">here</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp61960784"></a>Libraries</h3></div></div></div><p>You will need to download and install several libraries. They
        must all be built in the same directory, to be able to link
        properly.</p><p>Choose a directory where you will unpack and compile OpenSSL,
        Zlib and Box Backup. We will call this the base directory. An example
        might be:</p><pre class="programlisting">C:\Documents and Settings\Your Username\Desktop\Box</pre><p>Make sure you know the full path to this directory.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp61963088"></a>OpenSSL</h4></div></div></div><p>You will need to compile OpenSSL using Visual C++. The latest
          release at this time, OpenSSL 0.9.8a, does not compile with Visual
          C++ 2005 out of the box, so you need <a class="ulink" href="http://www.boxbackup.org/svn/box/chris/win32/support/openssl-0.9.8a-vc2005.zip" target="_top">a
          patched version</a>. The <a class="ulink" href="http://www.openssl.org/source/openssl-0.9.8a.tar.gz" target="_top">original
          source</a> and <a class="ulink" href="http://www.boxbackup.org/svn/box/chris/win32/support/openssl-0.9.8a-win32fix.patch" target="_top">patch</a>
          are also available.</p><p>To compile OpenSSL:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Use a Windows unzipper such as <a class="ulink" href="http://www.winzip.com/" target="_top">WinZip (free trial)</a> to
              extract the <span class="bold"><strong>openssl-0.9.8a-vc2005.tar.gz</strong></span> archive,
              which you just downloaded, into the base directory.</p></li><li class="listitem"><p>Rename the folder from <span class="bold"><strong>openssl-0.9.8a-vc2005</strong></span> to <span class="bold"><strong>openssl</strong></span></p></li><li class="listitem"><p>Open a command shell (run <span class="bold"><strong>cmd.exe</strong></span>) and <span class="bold"><strong>cd</strong></span> to the openssl directory</p></li><li class="listitem"><p>Run the following commands:</p><pre class="programlisting">perl Configure VC-WIN32
ms\do_ms
"c:\program files\Microsoft Visual Studio 8\Common7\Tools\vsvars32.bat"
nmake -f ms\ntdll.mak</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idp61973456"></a>Zlib</h4></div></div></div><p>You will need to download the <a class="ulink" href="http://www.zlib.net/zlib123-dll.zip" target="_top">Zlib compiled DLL</a>.
          Create a directory called <span class="bold"><strong>zlib</strong></span> in
          the base directory, and unzip the file you just downloaded into that
          directory. You don't need to compile anything.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp61975760"></a>Download Box Backup</h3></div></div></div><p>The first version of Box Backup that's known to compile and with
        Visual C++ 2005 is available on the <a class="ulink" href="http://www.boxbackup.org/svn/box/chris/win32/vc2005-compile-fixes/" target="_top">Subversion
        server</a>. However, this version has not been extensively tested
        and may be out of date.</p><p>The changes are expected to be merged into the <a class="ulink" href="http://www.boxbackup.org/svn/box/trunk" target="_top">Subversion trunk</a>
        at some point, and this page should then be updated. If in doubt,
        please sign up to the <a class="ulink" href="http://lists.warhead.org.uk/mailman/listinfo/boxbackup" target="_top">mailing
        list</a> and ask us.</p><p>To get the source code out of Subversion you will need a <a class="ulink" href="http://subversion.tigris.org/files/documents/15/25364/svn-1.2.3-setup.exe" target="_top">Subversion
        client for Windows</a>. After installing it, open a new command
        prompt, go to the base directory, and type:</p><pre class="programlisting">svn co http://www.boxbackup.org/svn/box/chris/win32/vc2005-compile-fixes/ boxbackup</pre><p>This should create a directory called <span class="bold"><strong>boxbackup</strong></span> inside the base directory.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp61981264"></a>Configure Box Backup</h3></div></div></div><p>Open a command prompt, change to the base directory then
        <span class="bold"><strong>boxbackup</strong></span>, and run <span class="bold"><strong>win32.bat</strong></span> to configure the sources. Otherwise,
        Visual C++ will complain about missing files whose names start with
        <span class="bold"><strong>autogen</strong></span>, and missing <span class="bold"><strong>config.h</strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp61984592"></a>Compile Box Backup</h3></div></div></div><p>Open Visual C++. Choose "File/Open/Project", navigate to the
        base directory, then to <span class="bold"><strong>boxbackup\infrastructure\msvc\2005</strong></span> (or
        <span class="bold"><strong>2003</strong></span> if using Visual Studio 2003),
        and open any project or solution file in that directory.</p><p>Press F7 to compile Box Backup. If the compilation is
        successful, <span class="bold"><strong>boxbackup\Debug\bbackupd.exe</strong></span> will be
        created.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp61987664"></a>Install Box Backup</h3></div></div></div><p>Create the destination directory, <span class="bold"><strong>C:\Program Files\Box Backup\bbackupd</strong></span>.</p><p>Write a configuration file, keys and certificate on a Unix
        machine, and copy them into the <span class="bold"><strong>Box
        Backup</strong></span> directory, together with the following files from
        the base directory:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>boxbackup\Debug\bbackupd.exe</p></li><li class="listitem"><p>openssl\out32dll\libeay32.dll</p></li><li class="listitem"><p>openssl\out32dll\ssleay32.dll</p></li><li class="listitem"><p>zlib\zlib1.dll</p></li></ul></div><p>Ensure that the user running Box Backup can read from the
        <span class="bold"><strong>Box Backup</strong></span> directory, and write to
        the <span class="bold"><strong>bbackupd</strong></span> directory inside
        it.</p><p>Run Box Backup by double-clicking on it, and check that it
        connects to the server. If the window opens and closes immediately,
        it's probably due to a problem with the configuration file - check the
        Windows Event Viewer for details.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp61995600"></a>Windows Service</h3></div></div></div><p>Box Backup can also run as a Windows service, in which case it
        will be automatically started at boot time in the background. To
        install this, open a command prompt, and run:</p><pre class="programlisting">cd "C:\Program Files\Box Backup"
bbackupd.exe -i</pre><p>This should output Box Backup service installed.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="apa.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="apc.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Appendix A. Box Backup and SSL </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Appendix C. Compilation and installation by building an RPM on
    Linux</td></tr></table></div></body></html>
